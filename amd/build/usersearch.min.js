define("local_registration/usersearch",["jquery","local_datatables/repository","local_datatables/datatables/dataTables.helper","core_form/modalform","core/toast","core/str","core/notification","local_datatables/datatables/dataTables.dateTime","local_datatables/datatables/moment","local_datatables/datatables/jquery.dataTables","local_datatables/datatables/dataTables.bootstrap4","local_datatables/datatables/dataTables.responsive","local_datatables/datatables/responsive.bootstrap4","local_datatables/datatables/dataTables.buttons","local_datatables/datatables/buttons.bootstrap4","local_datatables/datatables/buttons.colVis","local_datatables/datatables/buttons.html5","local_datatables/datatables/buttons.print","local_datatables/bootstrap-select/bootstrap-select"],(function($,Repository,Helper,ModalForm,Toast,Str,Notification,DateTime,moment){function createModalForm(table,formClass,titleKey,successKey){return function(event){var title=Str.get_strings([{key:titleKey,component:"local_registration"}]),id=$(this).attr("data-id"),langString=Str.get_strings([{key:successKey,component:"local_registration"}]),modal=new ModalForm({formClass:"local_registration\\form\\"+formClass+"_form",args:{id:id},modalConfig:{title:title},returnFocus:event.currentTarget,saveButtonText:Str.get_string("save")});modal.show(),modal.addEventListener(modal.events.FORM_SUBMITTED,(()=>{table.draw(),Toast.add(langString,{autohide:!0,closeButton:!0,type:"success"})}))}}return{init:function(){$(document).ready((function(){var tableid="#usersearch",table=$(tableid).DataTable({initComplete:function(){var typingTimer;$(tableid+" .filters").on("keyup","input",(function(){clearTimeout(typingTimer),typingTimer=setTimeout(function(){table.column($(this).data("index")).search(this.value).draw()}.bind(this),500)})),$(tableid+" .filters").on("keydown","input",(function(){clearTimeout(typingTimer)})),$(tableid+" .filters").on("change","select",(function(){var selectedValues=$(this).val();Array.isArray(selectedValues)&&selectedValues.length>1?table.column($(this).data("index")).search(selectedValues.join("|"),!0,!1).draw():table.column($(this).data("index")).search(selectedValues).draw()}));const timeCreatedElement=document.getElementById("timecreated");if(timeCreatedElement){const index=timeCreatedElement.getAttribute("data-index");DateTime.use(moment),new DateTime(timeCreatedElement,{format:"DD/MM/YY",buttons:{clear:!0},onChange:function(value,date,input){table.column(index).search(value).draw()}})}Helper.initResponsiveTable(table)},processing:!0,serverSide:!0,ajax:function(data,callback){Repository.process({data:JSON.stringify(data),namespace:"local_registration",tableid:"usersearch"}).then((function(json){callback(JSON.parse(json))})).catch((function(error){Notification.exception(error)}))},searchDelay:400,orderCellsTop:!0,fixedHeader:!0,responsive:{details:{type:"column",target:0}},paging:!0,order:[[1,"asc"]],lengthChange:!0,lengthMenu:[[10,20,30,-1],[10,20,30,"All"]],columns:[{defaultContent:""},{data:"firstname",name:"firstname"},{data:"lastname",name:"lastname"},{data:"email",name:"email",render:function(data,type,row){return 1==row.notified?row.email+'<br><span class="badge bg-warning">'+M.util.get_string("notified","local_registration")+"</span>":row.email}},{data:"tenantname",name:"t.id",orderable:"t.name",searchable:"equals||t.name"},{data:"country_formatted",name:"country",orderable:"country_text",searchable:"equals||country_text"},{data:"gender",name:"gender",searchable:"equals"},{data:"domain",name:"domain",searchable:"equals"},{data:"comments",name:"comments"},{data:"interests_formatted",name:"interests"},{data:"confirmed_formatted",name:"confirmed",orderable:"confirmed_text",searchable:"equals||confirmed_text"},{data:"timecreated_formatted",name:"lr.timecreated",searchable:"datetime"},{data:{},render:function(data){var btnApprove='<button class="btn btn-success btn-sm btn-approve" data-action="approve" data-id="'+data.id+'">'+M.util.get_string("approve","local_registration")+"</button>",btnReject='<button class="btn btn-danger btn-sm btn-reject" data-action="reject" data-id="'+data.id+'">'+M.util.get_string("reject","local_registration")+"</button>",btnNotify="";return 1!==data.notified&&(btnNotify='<button class="btn btn-warning btn-sm btn-notify" data-action="notify" data-id="'+data.id+'">'+M.util.get_string("notify","local_registration")+"</button>"),'<span class="buttons" data-value="'+data.id+'">'+btnApprove+btnReject+btnNotify+" </span>"},name:"actions",orderable:!1,searchable:!1}],columnDefs:[{targets:0,className:"dtr-control noVis",orderable:!1,searchable:!1}],dom:"<B<l><t>ftrip>",buttons:[{extend:"collection",className:"exportButton",text:"Export",buttons:[{extend:"copy",exportOptions:{columns:":visible:not(.noVis)"}},{extend:"print",exportOptions:{columns:":visible:not(.noVis)"}},{extend:"excel",exportOptions:{columns:":visible:not(.noVis)"}},{extend:"csv",exportOptions:{columns:":visible:not(.noVis)"}}]},{extend:"colvis",columns:":not(.noVis)"}]});table.on("click",".btn-approve",createModalForm(table,"approve","modal:approvetitle","modal:approvesuccess")),table.on("click",".btn-reject",createModalForm(table,"reject","modal:rejecttitle","modal:rejectsuccess")),table.on("click",".btn-notify",createModalForm(table,"notify","modal:notifytitle","modal:notifysuccess")),table.on("click",".reset-filters",(function(){Helper.resetTableFilters(table,!1)}))}))}}}));

//# sourceMappingURL=usersearch.min.js.map